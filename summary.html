<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜å¸³ç¸½è¦½ - 2026 æ—¥æœ¬è¡Œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #76c7ff; --bg: #f8f9fa; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding-bottom: 30px; }
        header { background: white; padding: 15px 20px; display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .back-btn { margin-right: 15px; cursor: pointer; }
        .container { padding: 20px; max-width: 500px; margin: auto; }
        .total-card { background: linear-gradient(135deg, #76c7ff, #5da9e9); color: white; padding: 30px 20px; border-radius: 25px; text-align: center; box-shadow: 0 10px 25px rgba(93,169,233,0.3); margin-bottom: 25px; }
        .chart-box { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
        h3 { color: #888; font-size: 15px; margin-bottom: 15px; }
        #loading { text-align: center; padding: 100px 0; color: #aaa; }
    </style>
</head>
<body>

<header>
    <div class="back-btn" onclick="location.href='index.html'">
        <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#76c7ff" stroke-width="3"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    </div>
    <b style="font-size: 18px;">ğŸ“Š æ”¯å‡ºçµ±è¨ˆç¸½è¦½</b>
</header>

<div id="loading">âœ¨ æ­£åœ¨çµ±è¨ˆå¸³ç›®...</div>

<div class="container" id="main-ui" style="display:none;">
    <div class="total-card">
        <div>ç›®å‰å…¨å®¶ç¸½æ”¯å‡º (JPY)</div>
        <div id="sumJPY" style="font-size: 38px; font-weight: bold; margin: 8px 0;">Â¥ 0</div>
        <div id="sumTWD" style="opacity: 0.9; font-size: 16px;">ç´„å°å¹£ $0 å…ƒ</div>
    </div>
    <div class="chart-box"><h3>ğŸ‘¤ æˆå“¡æ”¯å‡ºæ’å</h3><canvas id="userChart"></canvas></div>
    <div class="chart-box"><h3>ğŸ± æ¶ˆè²»åˆ†é¡ä½”æ¯”</h3><canvas id="catChart"></canvas></div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxktADedYUP_K5X8S0aJ-f0XKGjev2qOuNZi1LNN7E5vq1b26KA-71Oc1IZnR1drgYfdg/exec";

    async function fetchData() {
        if(localStorage.getItem('isLoggedIn') !== 'true') return location.href='index.html';
        try {
            const resp = await fetch(GAS_URL + "?type=history");
            const data = await resp.json();
            let total = 0, users = {}, cats = {};
            data.forEach(row => {
                const amt = parseFloat(row.æ—¥å¹£é‡‘é¡) || 0; total += amt;
                users[row.è¨˜éŒ„äºº] = (users[row.è¨˜éŒ„äºº] || 0) + amt;
                cats[row.é¡åˆ¥] = (cats[row.é¡åˆ¥] || 0) + amt;
            });
            document.getElementById('sumJPY').innerText = `Â¥ ${total.toLocaleString()}`;
            document.getElementById('sumTWD').innerText = `ç´„å°å¹£ $${Math.round(total * 0.215).toLocaleString()} å…ƒ`;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            renderChart('userChart', users, ['#76c7ff','#ffcb05','#ff9f40','#4bc0c0','#9966ff']);
            renderChart('catChart', cats, ['#ff6384','#36a2eb','#cc65fe','#ffce56','#4bc0c0','#f1f1f1']);
        } catch(e) { document.getElementById('loading').innerText = "è®€å–å¤±æ•—"; }
    }

    function renderChart(id, stats, colors) {
        new Chart(document.getElementById(id), { type: 'doughnut', data: { labels: Object.keys(stats), datasets: [{ data: Object.values(stats), backgroundColor: colors, borderWidth: 0 }] }, options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } } });
    }
    fetchData();
</script>
</body>
</html>
