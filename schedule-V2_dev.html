<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¼•äº•æ¾¤ã€‚æ±äº¬</title>
    <style>
        :root { --primary: #5c4ee5; --bg: #f5f6fa; --danger: #ff7675; }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; overflow-x: hidden; scroll-behavior: smooth; }
        
        .top-container { background: var(--primary); padding-bottom: 12px; position: sticky; top: 0; z-index: 2000; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        header { padding: 20px 20px 8px; display: flex; align-items: center; justify-content: space-between; color: white; }
        .header-title-group { display: flex; align-items: center; gap: 12px; }
        .main-title { font-size: 24px; font-weight: 900; letter-spacing: 0.5px; color: white; }
        
        /* 3. æŒ‰éˆ•ç¾åŒ–ï¼š03/01 D1 æ ¼å¼ */
        .date-selector { display: flex; overflow-x: auto; padding: 10px 20px; gap: 10px; scrollbar-width: none; }
        .date-box { 
            min-width: 75px; padding: 10px 4px; background: rgba(255,255,255,0.12); 
            border-radius: 15px; text-align: center; color: rgba(255,255,255,0.8); flex-shrink: 0; 
        }
        .date-box .day-num { font-size: 11px; display: block; margin-bottom: 2px; font-weight: bold; }
        .date-box .day-id { font-size: 19px; font-weight: 900; }
        .date-box.active { background: white; color: var(--primary); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }

        /* 4. å¤©æ°£çœ‹æ¿è¨­è¨ˆ */
        .dashboard { padding: 20px; background: white; margin: 15px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .weather-row { display: flex; justify-content: space-between; align-items: flex-end; }
        .loc-tag { font-size: 12px; background: #f2f3ff; color: var(--primary); padding: 4px 10px; border-radius: 8px; font-weight: 800; }
        .temp-main { font-size: 38px; font-weight: 900; color: #2d3436; line-height: 1; margin: 8px 0; }
        .weather-desc { font-size: 14px; color: #636e72; font-weight: bold; }
        .memo-box { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-size: 13px; color: #7f8c8d; line-height: 1.6; }

        /* è¡Œç¨‹è»¸æ¨£å¼ */
        .timeline-container { display: flex; padding: 0 15px 15px; position: relative; }
        .timeline-line { position: absolute; left: 30px; top: 0; bottom: 30px; width: 2px; background: #e0e0e0; z-index: 1; }
        .drop-zone { flex-grow: 1; position: relative; z-index: 2; padding-left: 35px; }

        .event-card {
            background: white; border-radius: 20px; padding: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.04); display: flex; gap: 15px; align-items: center;
            position: relative; margin-bottom: 12px;
        }
        .event-card::before {
            content: ""; position: absolute; left: -32px; top: 50%;
            width: 10px; height: 10px; background: var(--primary);
            border-radius: 50%; border: 3px solid #fff;
            transform: translateY(-50%); box-shadow: 0 0 0 2px #e0e0e0;
        }

        /* ç™¼å…‰æ•ˆæœ */
        .event-card.is-current::before {
            background: #fff; border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(92, 78, 229, 0.2), 0 0 20px var(--primary);
            animation: pulseGlow 1.5s infinite;
        }
        @keyframes pulseGlow {
            0% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.3); }
            100% { transform: translateY(-50%) scale(1); }
        }

        .card-time-block { background: #f8f9fb; border-radius: 12px; min-width: 65px; height: 65px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .time-hm { font-size: 18px; font-weight: 900; color: #333; }
        .card-title { font-size: 16px; font-weight: 800; color: #2d3436; margin: 0; }
        
        body.edit-mode .timeline-line, body.edit-mode .event-card::before { display: none; }
    </style>
</head>
<body>

<div class="top-container">
    <header>
        <div class="header-title-group">
            <svg viewBox="0 0 24 24" width="28" height="28" fill="white"><path d="M22,11H19.17l2.42-2.41a1,1,0,1,0-1.42-1.42L17.58,10H13V5.42l2.59-2.59a1,1,0,0,0-1.42-1.42L12,3.83,9.83,1.41A1,1,0,1,0,8.41,2.83L11,5.42V10H6.42L3.83,7.17A1,1,0,1,0,2.41,8.59L4.83,11H2a1,1,0,0,0,0,2H4.83l-2.42,2.41a1,1,0,1,0,1.42,1.42L6.42,14H11v4.58L8.41,21.17a1,1,0,1,0,1.42,1.42L12,20.17l2.17,2.42a1,1,0,0,0,1.42-1.42L13,18.58V14h4.58l2.59,2.59a1,1,0,0,0,1.42-1.42L19.17,13H22a1,1,0,0,0,0-2Z"/></svg>
            <span class="main-title">è¼•äº•æ¾¤ã€‚æ±äº¬</span>
        </div>
        <button id="toggleBtn" onclick="toggleEditMode()" style="background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.3); color:white; padding:6px 12px; border-radius:12px; font-size:11px; font-weight:bold;">èª¿æ•´ä½ç½®</button>
    </header>
    <div class="date-selector" id="dateSelector"></div>
</div>

<div id="dashboardArea"></div>

<div class="timeline-container">
    <div class="timeline-line"></div>
    <div class="drop-zone" id="dropZone"></div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbz7lrfOtPmZH7fqUwbiRk3KgHAwZATgi51VSt2YqFamEinhdaxRvzqpMSrtUq7PsAK0bQ/exec";
    let allData = [], currentDay = "2026/03/01";

    // 4. å¤©æ°£è³‡æ–™é è¨­
    const weatherData = {
        "D1": { loc: "è¼•äº•æ¾¤", temp: "-2Â° / 6Â°", desc: "â„ï¸ æ™´æ™‚å¤šé›²ï¼Œæ³¨æ„ä¿æš–", memo: "æŠµé”è¼•äº•æ¾¤ï¼Œé–‹å•Ÿé›ªåœ‹ä¹‹æ—…ã€‚è¨˜å¾—å…ˆå»é£¯åº—å¯„æ”¾è¡Œæã€‚" },
        "D2": { loc: "è¼•äº•æ¾¤", temp: "-4Â° / 4Â°", desc: "â˜€ï¸ æ™´æœ—ï¼Œé«”æ„Ÿæº«åº¦æ¥µä½", memo: "çŸ³ä¹‹æ•™å ‚èˆ‡é«˜åŸæ•™æœƒè¡Œç¨‹ï¼Œå»ºè­°ç©¿è‘—ç™¼ç†±è¡£ã€‚" },
        "D3": { loc: "è¼•äº•æ¾¤", temp: "-1Â° / 7Â°", desc: "â˜ï¸ å¤šé›²è½‰æ™´", memo: "ç‹å­è³¼ç‰©å»£å ´ï¼ˆOutletï¼‰è¡€æ‹¼æ—¥ï¼Œæº–å‚™å¥½è¶³å¤ çš„é«”åŠ›ã€‚" },
        "D4": { isDouble: true, loc1: "è¼•äº•æ¾¤", temp1: "0Â°/6Â°", loc2: "æ±äº¬", temp2: "8Â°/14Â°", desc: "ğŸš„ åŸå¸‚ç§»é˜²", memo: "ä¸­åˆæ­ä¹˜æ–°å¹¹ç·šå‰å¾€æ±äº¬ï¼Œæº«å·®è¼ƒå¤§æ³¨æ„ç©¿è„«è¡£ç‰©ã€‚" },
        "D5": { loc: "æ±äº¬", temp: "7Â° / 15Â°", desc: "â˜€ï¸ æ™´æœ—èˆ’é©", memo: "æ·ºè‰é›·é–€èˆ‡æ™´ç©ºå¡”ï¼Œæ„Ÿå—æ±äº¬ä¸‹ç”ºæ–‡åŒ–èˆ‡ç¾ä»£åœ°æ¨™ã€‚" },
        "D6": { loc: "æ±äº¬", temp: "9Â° / 16Â°", desc: "ğŸŒ§ï¸ å±€éƒ¨é™£é›¨", memo: "æœ€å¾Œæ¡è²·ï¼Œæº–å‚™å‰å¾€æ©Ÿå ´ã€‚è¨˜å¾—æª¢æŸ¥è­·ç…§èˆ‡æ©Ÿç¥¨ã€‚" }
    };

    function renderDashboard(dayId) {
        const d = weatherData[dayId];
        let html = '';
        if(d.isDouble) {
            html = `<div class="dashboard"><div class="weather-row">
                <div><span class="loc-tag">${d.loc1}</span><div class="temp-main">${d.temp1}</div></div>
                <div style="text-align:right;"><span class="loc-tag">${d.loc2}</span><div class="temp-main">${d.temp2}</div></div>
            </div><div class="weather-desc">ğŸš„ ${d.desc}</div><div class="memo-box">${d.memo}</div></div>`;
        } else {
            html = `<div class="dashboard"><div class="weather-row">
                <div><span class="loc-tag">${d.loc}</span><div class="temp-main">${d.temp}</div><div class="weather-desc">${d.desc}</div></div>
                <div style="font-size:40px;">${d.desc.includes('â˜€ï¸')?'â˜€ï¸':'â˜ï¸'}</div>
            </div><div class="memo-box">${d.memo}</div></div>`;
        }
        document.getElementById('dashboardArea').innerHTML = html;
    }

    async function loadData() {
        const r = await fetch(GAS_URL + "?type=schedule");
        allData = await r.json();
        renderDates();
        renderTimeline();
    }

    function renderDates() {
        const dates = ["2026/03/01", "2026/03/02", "2026/03/03", "2026/03/04", "2026/03/05", "2026/03/06"];
        document.getElementById('dateSelector').innerHTML = dates.map((d, i) => `
            <div class="date-box ${currentDay === d ? 'active' : ''}" onclick="setDay('${d}', 'D${i+1}')">
                <span class="day-num">${d.split('/')[1]}/${d.split('/')[2]}</span>
                <span class="day-id">D${i+1}</span>
            </div>
        `).join('');
        renderDashboard(`D${dates.indexOf(currentDay)+1}`);
    }

    function setDay(d, id) { currentDay = d; renderDates(); renderTimeline(); }

    function renderTimeline() {
        const zone = document.getElementById('dropZone');
        zone.innerHTML = '';
        const dayData = allData.filter(item => (item.æ—¥æœŸ || "").replace(/-/g, '/') === currentDay).sort((a,b) => a.æ™‚é–“.localeCompare(b.æ™‚é–“));
        
        const now = new Date();
        const currentMins = now.getHours() * 60 + now.getMinutes();
        let closestIndex = -1, minDiff = Infinity;

        dayData.forEach((item, index) => {
            const [h, m] = item.æ™‚é–“.split(':').map(Number);
            const itemMins = h * 60 + m;
            const diff = currentMins - itemMins;
            if (diff >= 0 && diff < minDiff) { minDiff = diff; closestIndex = index; }

            const card = document.createElement('div');
            card.className = `event-card ${index === closestIndex ? 'is-current' : ''}`;
            if(index === closestIndex) card.id = 'active-task'; // æ¨™è¨˜æ²å‹•ç›®æ¨™

            card.innerHTML = `
                <div class="card-time-block"><span class="time-hm">${item.æ™‚é–“}</span></div>
                <div class="card-main"><h4 class="card-title">${item.æ¨™é¡Œ}</h4>
                <div style="font-size:13px; color:#777; margin-top:5px;">${item.å…§å®¹ || ''}</div></div>`;
            zone.appendChild(card);
        });

        // 1. è‡ªå‹•æ²å‹•åŠŸèƒ½
        setTimeout(() => {
            const activeEl = document.getElementById('active-task');
            if(activeEl) {
                const offset = activeEl.getBoundingClientRect().top + window.pageYOffset - 250;
                window.scrollTo({ top: offset, behavior: 'smooth' });
            }
        }, 500);
    }

    window.onload = loadData;
</script>
</body>
</html>
