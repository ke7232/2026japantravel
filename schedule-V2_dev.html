<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>輕井澤。東京 (V2 PRO)</title>
    <style>
        :root { 
            --primary: #5c4ee5; 
            --bg: #f5f6fa;
            --slot-h: 32px;
            --danger: #ff7675;
        }
        body { font-family: "PingFang TC", sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; overflow-x: hidden; }
        
        .top-container {
            background: var(--primary);
            padding-bottom: 12px; 
            position: sticky; top: 0; z-index: 2000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        header { 
            padding: 20px 20px 8px; 
            display: flex; align-items: center; justify-content: space-between; color: white;
        }

        .header-title-group { display: flex; align-items: center; gap: 12px; }
        .main-title { font-size: 24px; font-weight: 800; letter-spacing: 0.5px; color: white; }
        .version-tag { font-size: 8px; background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.7); padding: 1px 5px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }

        /* 修正：D1 標籤排版 (取消粗體) */
        .date-selector { display: flex; overflow-x: auto; padding: 5px 20px 10px; gap: 10px; scrollbar-width: none; }
        .date-box { 
            min-width: 60px; padding: 10px 6px; 
            background: rgba(255,255,255,0.12); 
            border-radius: 10px; 
            text-align: center; 
            color: rgba(255,255,255,0.6); flex-shrink: 0; transition: 0.25s ease;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .date-box .day-num { 
            font-size: 10px; display: block; margin-bottom: 4px; 
            font-weight: normal; opacity: 0.9;
        }
        .date-box .day-id { 
            font-size: 16px; 
            font-weight: normal; /* 取消 Day1/D1 的粗體 */
            letter-spacing: 0.5px;
        }
        
        .date-box.active { 
            background: white; color: var(--primary); 
            box-shadow: 0 6px 15px rgba(0,0,0,0.15); 
            transform: translateY(-1px);
        }

        .timeline-container { display: flex; padding: 15px 15px; position: relative; }
        .drop-zone { flex-grow: 1; position: relative; }
        .event-card {
            background: white; border-radius: 20px; padding: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.04); 
            display: flex; gap: 15px; align-items: center;
            position: relative; margin-bottom: 12px;
        }
        .card-time-block {
            background: #f8f9fb; border-radius: 12px;
            min-width: 65px; height: 65px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .time-hm { font-size: 18px; font-weight: 900; color: #333; }
        .card-title { font-size: 16px; font-weight: 800; color: #2d3436; margin: 0; }
        
        .add-fab { position: fixed; bottom: 30px; right: 25px; width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; border: none; box-shadow: 0 8px 30px rgba(92, 78, 229, 0.4); }
        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 12px 25px; border-radius: 30px; font-size: 13px; display: none; z-index: 5000; }
    </style>
</head>
<body>

<div class="top-container">
    <header>
        <div class="header-title-group">
            <div onclick="location.href='index.html'" style="cursor:pointer;"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="white" stroke-width="3"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></div>
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
                <line x1="12" y1="3" x2="12" y2="21" />
                <line x1="3" y1="12" x2="21" y2="12" />
                <line x1="5.64" y1="5.64" x2="18.36" y2="18.36" />
                <line x1="18.36" y1="5.64" x2="5.64" y2="18.36" />
            </svg>
            <span class="main-title">輕井澤。東京</span>
            <span class="version-tag">Ver. 0121-1220</span>
        </div>
        <button id="toggleBtn" style="padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white;">調整位置</button>
    </header>

    <div class="date-selector" id="dateSelector"></div>
</div>

<div class="timeline-container">
    <div class="drop-zone" id="dropZone"></div>
</div>

<button class="add-fab">＋</button>
<div id="toast"></div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbz7lrfOtPmZH7fqUwbiRk3KgHAwZATgi51VSt2YqFamEinhdaxRvzqpMSrtUq7PsAK0bQ/exec";
    let allData = [], currentDay = "2026/03/01";

    function getYoBi(dateString) {
        const days = ['日', '月', '火', '水', '木', '金', '土'];
        const d = new Date(dateString);
        return days[d.getDay()];
    }

    // 更新日期標籤顯示格式
    function renderDates() {
        const dates = ["2026/03/01", "2026/03/02", "2026/03/03", "2026/03/04", "2026/03/05", "2026/03/06"];
        document.getElementById('dateSelector').innerHTML = dates.map((d, i) => `
            <div class="date-box ${currentDay === d ? 'active' : ''}" onclick="setDay('${d}')">
                <span class="day-num">${d.split('/')[1]}/${d.split('/')[2]} ${getYoBi(d)}</span>
                <span class="day-id">D${i+1}</span>
            </div>
        `).join('');
    }

    function setDay(d) { currentDay = d; renderDates(); renderTimeline(); }

    async function loadData() {
        const r = await fetch(GAS_URL + "?type=schedule");
        allData = await r.json();
        renderDates();
        renderTimeline();
    }

    function renderTimeline() {
        const zone = document.getElementById('dropZone');
        zone.innerHTML = '';
        const dayData = allData.filter(item => (item.日期 || "").replace(/-/g, '/') === currentDay).sort((a,b) => a.時間.localeCompare(b.時間));

        dayData.forEach((item) => {
            const card = document.createElement('div');
            card.className = 'event-card';
            card.innerHTML = `
                <div class="card-time-block">
                    <span style="font-size:10px; color:#999; font-weight:bold;">${item.時間.split(':')[0] < 12 ? '午前' : '午後'}</span>
                    <span class="time-hm">${item.時間}</span>
                </div>
                <div class="card-main">
                    <h4 class="card-title">${item.標題}</h4>
                    <div style="font-size:13px; color:#777; margin-top:4px;">${item.內容 || ''}</div>
                </div>
            `;
            zone.appendChild(card);
        });
    }

    window.onload = loadData;
</script>
</body>
</html>
